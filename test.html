<div id="adContainer"></div>

  <script>
    (function () {
      const IMA_SDK_URL = "https://imasdk.googleapis.com/js/sdkloader/ima3.js";
      let adsLoader, adsManager;

      // Dynamically load the IMA SDK
      const loadIMASDK = () => {
        return new Promise((resolve, reject) => {
          const script = document.createElement("script");
          script.src = IMA_SDK_URL;
          script.async = true;
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        });
      };

      // Initialize the ad container and IMA SDK
      const initAds = async () => {
        try {
          await loadIMASDK();

          const adContainer = document.getElementById("adContainer");
          const adDisplayContainer = new google.ima.AdDisplayContainer(adContainer);
          adDisplayContainer.initialize();

          // Set up the AdsLoader
          adsLoader = new google.ima.AdsLoader(adDisplayContainer);
          adsLoader.addEventListener(
            google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
            onAdsManagerLoaded,
            false
          );
          adsLoader.addEventListener(
            google.ima.AdErrorEvent.Type.AD_ERROR,
            onAdError,
            false
          );

          // Request ads
          const adsRequest = new google.ima.AdsRequest();
          adsRequest.adTagUrl = "https://pubads.g.doubleclick.net/gampad/ads?iu=/22818991658/2025&description_url=[placeholder]&tfcd=0&npa=0&sz=640x480%7C580x400&ciu_szs=580x400&gdfp_req=1&unviewed_position_start=1&output=vast&env=vp&impl=s&correlator=";
          adsRequest.linearAdSlotWidth = adContainer.offsetWidth;
          adsRequest.linearAdSlotHeight = adContainer.offsetHeight;
          adsRequest.nonLinearAdSlotWidth = adContainer.offsetWidth;
          adsRequest.nonLinearAdSlotHeight = adContainer.offsetHeight;

          adsLoader.requestAds(adsRequest);
        } catch (error) {
          console.error("Error initializing ads:", error);
        }
      };

      // Handle the adsManagerLoaded event
      const onAdsManagerLoaded = (event) => {
        const adContainer = document.getElementById("adContainer");
        adsManager = event.getAdsManager(adContainer);

        // Attach event listeners for ad events
        adsManager.addEventListener(google.ima.AdEvent.Type.STARTED, () => {
          console.log("Ad started");
        });
        adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE, () => {
          console.log("Ad complete");
        });
        adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED, () => {
          console.log("All ads completed");
        });
        adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR, onAdError);

        try {
          adsManager.init(adContainer.offsetWidth, adContainer.offsetHeight, google.ima.ViewMode.NORMAL);
          adsManager.start();
        } catch (error) {
          console.error("Error starting adsManager:", error);
          adContainer.style.display = "none";
        }
      };

      // Handle ad errors
      const onAdError = (error) => {
        console.error("Ad error:", error.getError());
        document.getElementById("adContainer").style.display = "none";
      };

      // Start the process
      window.onload = initAds;
    })();
  </script>
